<main class="main-content">

  <div *ngIf="errorMessage" class="error-banner">
    {{ errorMessage }}
    <button class="retry-btn" (click)="loadDashboardData()">Réessayer</button>
  </div>

  <section id="stats" class="stats-grid">
    <article class="stat-card success">
      <div class="card-header">
        <div class="card-icon-wrapper">
          <img src="assets/30_23.svg" alt="Building Icon">
        </div>
        <span class="card-value" [class.loading]="isLoading">
          {{ isLoading ? '...' : formatNumber(stats.entreprisesActives) }}
        </span>
      </div>
      <div class="card-body">
        <p class="card-title">Entreprises actives</p>
        <div class="progress-bar">
          <div class="progress-bar-fill" 
               [style.width.%]="stats.pourcentageEntreprisesActives"
               [class.animate]="!isLoading">
          </div>
        </div>
        <div class="card-footer">
          <span>Sur {{ isLoading ? '...' : formatNumber(stats.totalEntreprises) }} totals</span>
          <span>{{ isLoading ? '...' : stats.pourcentageEntreprisesActives }} %</span>
        </div>
      </div>
    </article>

    <article class="stat-card warning">
      <div class="card-header">
        <div class="card-icon-wrapper">
          <img src="assets/30_77.svg" alt="Users Icon">
        </div>
        <span class="card-value" [class.loading]="isLoading">
          {{ isLoading ? '...' : formatNumber(stats.utilisateursActifs) }}
        </span>
      </div>
      <div class="card-body">
        <p class="card-title">Utilisateurs actifs</p>
        <div class="progress-bar">
          <div class="progress-bar-fill" 
               [style.width.%]="stats.pourcentageUtilisateursActifs"
               [class.animate]="!isLoading">
          </div>
        </div>
        <div class="card-footer">
          <span>Sur {{ isLoading ? '...' : formatNumber(stats.totalUtilisateurs) }} totals</span>
          <span>{{ isLoading ? '...' : stats.pourcentageUtilisateursActifs }} %</span>
        </div>
      </div>
    </article>

    <article class="stat-card danger">
      <div class="card-header">
        <div class="card-icon-wrapper">
          <img src="assets/30_80.svg" alt="Document Icon">
        </div>
        <span class="card-value" [class.loading]="isLoading">
          {{ isLoading ? '...' : formatNumber(totalDocuments) }}
        </span>
      </div>
      <div class="card-body">
        <p class="card-title">Documents partagés</p>
        <div class="progress-bar">
          <div class="progress-bar-fill" 
               [style.width.%]="100"
               [class.animate]="!isLoading">
          </div>
        </div>
        <div class="card-footer">
          <span>Total documents</span>
          <span>100 %</span>
        </div>
      </div>
    </article>
  </section>

  <section id="activity" class="activity-section">
    <div class="activity-header">
      <h3>Activité globale de la plateforme</h3>
      <div class="activity-actions">
        <select class="periode-select" 
                [value]="currentPeriode" 
                (change)="onPeriodeChange($any($event.target).value)"
                [disabled]="chartLoading">
          <option value="jour">Aujourd'hui</option>
          <option value="semaine">Cette semaine</option>
          <option value="mois">Ce mois</option>
        </select>
        
        <button class="btn btn-primary" (click)="exportChart()">
          <img src="" alt="">
          Exporter
        </button>
      </div>
    </div>
    <div class="chart-container">
      <div *ngIf="chartLoading" class="chart-loading">
        <div class="loading-spinner"></div>
        <p>Chargement des données en temps réel...</p>
      </div>
      <canvas baseChart
              [data]="lineChartData"
              [options]="lineChartOptions"
              [type]="lineChartType"
              *ngIf="!chartLoading">
      </canvas>
    </div>
  </section>

</main>