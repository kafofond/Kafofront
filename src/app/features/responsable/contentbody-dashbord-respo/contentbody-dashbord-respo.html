<main class="main-content">

  <!-- Indicateur de chargement -->
  <div *ngIf="isLoading" class="loading-indicator">
    <div class="spinner"></div>
    <p>Chargement des données crédits...</p>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage" class="error-banner">
    {{ errorMessage }}
    <button class="retry-btn" (click)="loadDashboardData()">Réessayer</button>
  </div>

  <section id="stats" class="stats-cards" *ngIf="!isLoading && !errorMessage">
    <!-- Carte Crédits Affectés -->
    <div class="stat-card-wrapper green-border">
      <div class="stat-card">
        <div class="card-header">
          <div class="card-icon-container green-icon">
            <img src="assets/40_44.svg" alt="Credits Icon">
          </div>
          <span class="card-value">{{ formatCurrency(stats.creditsAffectes) }}</span>
        </div>
        <p class="card-title">Crédits affectés</p>
        <div class="progress-bar-container">
          <div class="progress-bar-bg">
            <div class="progress-bar-fg green-bar" [style.width]="getAffectesWidth()"></div>
          </div>
        </div>
        <div class="card-footer">
          <span>Par rapport au budget</span>
          <span>{{ stats.pourcentageUtilisation }} %</span>
        </div>
      </div>
    </div>

    <!-- Carte Crédits Utilisés -->
    <div class="stat-card-wrapper orange-border">
      <div class="stat-card">
        <div class="card-header">
          <div class="card-icon-container orange-icon">
            <img src="assets/40_64.svg" alt="Exchange Icon">
          </div>
          <span class="card-value">{{ formatCurrency(stats.creditsUtilises) }}</span>
        </div>
        <p class="card-title">Crédits utilisés</p>
        <div class="progress-bar-container">
          <div class="progress-bar-bg">
            <div class="progress-bar-fg orange-bar" [style.width]="getUtilisesWidth()"></div>
          </div>
        </div>
        <div class="card-footer">
          <span>{{ stats.pourcentageUtilisation }}% des crédits affectés</span>
          <span>{{ stats.pourcentageUtilisation }} %</span>
        </div>
      </div>
    </div>

    <!-- Carte Crédits Restants -->
    <div class="stat-card-wrapper red-border">
      <div class="stat-card">
        <div class="card-header">
          <div class="card-icon-container red-icon">
            <img src="assets/40_77.svg" alt="Piggy Bank Icon">
          </div>
          <span class="card-value">{{ formatCurrency(stats.creditsRestants) }}</span>
        </div>
        <p class="card-title">Crédits restants</p>
        <div class="progress-bar-container">
          <div class="progress-bar-bg">
            <div class="progress-bar-fg red-bar" [style.width]="getRestantsWidth()"></div>
          </div>
        </div>
        <div class="card-footer">
          <span>{{ stats.pourcentageRestant }}% disponible</span>
          <span>{{ stats.pourcentageRestant }} %</span>
        </div>
      </div>
    </div>
  </section>

  <section id="activity" class="activity-section" *ngIf="!isLoading && !errorMessage">
    <div class="activity-header">
      <h3>Évolution des crédits par période</h3>
      <div class="activity-controls">
        <select id="periodSelect" [value]="currentPeriode" (change)="onPeriodeChange($event)">
          <option value="jour">Aujourd'hui</option>
          <option value="semaine">Cette semaine</option>
          <option value="mois">Ce mois</option>
        </select>

        <div class="activity-actions">
          <button class="btn btn-secondary" (click)="exportChart()">
            Exporter
          </button>
        </div>
      </div>
    </div>
    <div class="chart-container">
      <div *ngIf="chartLoading" class="chart-loading">
        <div class="spinner"></div>
        <p>Chargement du graphique...</p>
      </div>
      <canvas baseChart
        [data]="lineChartData"
        [options]="lineChartOptions"
        [type]="'line'">
      </canvas>
    </div>
  </section>

</main>