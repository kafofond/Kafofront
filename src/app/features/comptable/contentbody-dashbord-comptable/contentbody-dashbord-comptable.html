<main class="main-content">

  <!-- Indicateur de chargement -->
  <div *ngIf="isLoading" class="loading-indicator">
    <div class="spinner"></div>
    <p>Chargement des données financières...</p>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage" class="error-banner">
    {{ errorMessage }}
    <button class="retry-btn" (click)="loadDashboardData()">Réessayer</button>
  </div>

  <section id="stats" class="stats-cards" *ngIf="!isLoading && !errorMessage">
    <!-- Carte Demandes d'Achat -->
    <div class="stat-card-wrapper green">
      <div class="stat-card">
        <div class="card-header">
          <div class="card-icon-container green-bg">
            <img src="assets/41_5.svg" alt="Demande d'achat Icon">
          </div>
          <span class="card-value">{{ formatNumber(stats.totalDemandesAchat) }}</span>
        </div>
        <p class="card-title">Demandes d'Achat</p>
        <div class="progress-bar">
          <div class="progress-fill green" [style.width]="getDemandesWidth()"></div>
        </div>
        <div class="card-footer">
          <span>{{ stats.demandesEnAttente }} en attente</span>
          <span>{{ stats.pourcentageDemandesTraitees }} %</span>
        </div>
      </div>
    </div>

    <!-- Carte Bons de Commande -->
    <div class="stat-card-wrapper orange">
      <div class="stat-card">
        <div class="card-header">
          <div class="card-icon-container orange-bg">
            <img src="assets/41_7.svg" alt="Bon de commande Icon">
          </div>
          <span class="card-value">{{ formatNumber(stats.totalBonsCommande) }}</span>
        </div>
        <p class="card-title">Bons de Commande</p>
        <div class="progress-bar">
          <div class="progress-fill orange" [style.width]="getBonsWidth()"></div>
        </div>
        <div class="card-footer">
          <span>{{ stats.bonsEnAttente }} en attente</span>
          <span>{{ stats.pourcentageBonsValides }} %</span>
        </div>
      </div>
    </div>

    <!-- Carte Ordres de Paiement -->
    <div class="stat-card-wrapper red">
      <div class="stat-card">
        <div class="card-header">
          <div class="card-icon-container blue-bg">
            <img src="assets/41_9.svg" alt="Ordre de paiement Icon">
          </div>
          <span class="card-value">{{ formatNumber(stats.totalOrdresPaiement) }}</span>
        </div>
        <p class="card-title">Ordres de Paiement</p>
        <div class="progress-bar">
          <div class="progress-fill red" [style.width]="getOrdresWidth()"></div>
        </div>
        <div class="card-footer">
          <span>{{ stats.ordresEnAttente }} en attente</span>
          <span>{{ getOrdresPercentage() }} %</span>
        </div>
      </div>
    </div>
  </section>

  <section id="activity" class="activity-section" *ngIf="!isLoading && !errorMessage">
    <div class="activity-header">
      <h3>Évolution des validations par mois</h3>
      <div class="activity-controls">
        <select id="periodSelect" [value]="currentPeriode" (change)="onPeriodeChange($event)">
          <option value="jour">Aujourd'hui</option>
          <option value="semaine">Cette semaine</option>
          <option value="mois">Ce mois</option>
        </select>

        <div class="activity-actions">
          <button class="btn btn-secondary" (click)="exportChart()">
            Exporter
          </button>
        </div>
      </div>
    </div>
    <div class="chart-container">
      <div *ngIf="chartLoading" class="chart-loading">
        <div class="spinner"></div>
        <p>Chargement du graphique...</p>
      </div>
      <canvas baseChart
        [data]="lineChartData"
        [options]="lineChartOptions"
        [type]="'line'">
      </canvas>
    </div>
  </section>

</main>