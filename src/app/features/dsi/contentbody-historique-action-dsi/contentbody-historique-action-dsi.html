<section class="historique-section">
  <div class="historique-header">
  
    <div class="historique-filtres">
      <select id="filtre" [(ngModel)]="filtreAction" (ngModelChange)="loadHistorique()">
        <option value="toutes">Toutes</option>
        <option value="cree">Créé</option>
        <option value="modifie">Modifié</option>
        <option value="valide">Validé</option>
        <option value="rejete">Rejeté</option>
        <option value="approuve">Approuvé</option>
        <option value="active">Activé</option>
      </select>
      
      <select id="filtreType" [(ngModel)]="filtreTypeDocument" (ngModelChange)="loadHistorique()">
        <option value="tous">Tous les documents</option>
        <option value="BUDGET">Budget</option>
        <option value="LIGNE_CREDIT">Ligne de Credit</option>
        <option value="FICHE_BESOIN">Fiche de Besoin</option>
        <option value="DEMANDE_ACHAT">Demande d'Achat</option>
        <option value="BON_COMMANDE">Bon de Commande</option>
        <option value="ATTESTATION_SERVICE_FAIT">Attestation de Service</option>
        <option value="DECISION_PRELEVEMENT">Decision de Prelevement</option>
        <option value="ORDRE_PAIEMENT">Ordre de Paiement</option>
        <option value="ENTREPRISE">Entreprise</option>
        <option value="UTILISATEUR">Utilisateur</option>
      </select>
    </div>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="error" class="error-banner">
    <span>{{ error }}</span>
    <button class="retry-btn" (click)="retry()">Réessayer</button>
  </div>

  <!-- Chargement -->
  <div *ngIf="isLoading" class="loading-spinner">
    Chargement de l'historique...
  </div>

  <!-- Tableau -->
  <div *ngIf="!isLoading && historiquesFiltres.length > 0" class="table-container">
    <table class="historique-table">
      <thead class="header-color">
        <tr>
          <th>Fichier</th>
          <th>Auteur</th>
          <th>Type de document</th>
          <th>Action</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let h of historiquesPageCourante">
          <td>{{ h.fichier }}</td>
          <td>{{ h.auteur }}</td>
          <td>{{ h.typeDocumentFormate }}</td>
          <td>
            <span class="action-status" [ngClass]="{
              cree: h.action === 'Créé',
              modifie: h.action === 'Modifié',
              valide: h.action === 'Validé',
              rejete: h.action === 'Rejeté',
              desactive: h.action === 'Désactivé',
              reactive: h.action === 'Réactivé',
              approuve: h.action === 'Approuvé',
              active: h.action === 'Activé',
              miseajour: h.action === 'Mise à jour montants'
            }">
              {{ h.action }}
            </span>
          </td>
          <td>{{ h.date | date: 'yyyy-MM-dd HH:mm' }}</td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination">
      <button (click)="pagePrecedente()" [disabled]="pageActuelle === 1">Précédent</button>
      <span>Page {{ pageActuelle }} / {{ totalPages }}</span>
      <button (click)="pageSuivante()" [disabled]="pageActuelle === totalPages">Suivant</button>
    </div>
  </div>

  <!-- Aucun résultat -->
  <div *ngIf="!isLoading && historiquesFiltres.length === 0 && !error" class="no-data">
    Aucune action trouvée dans l'historique
  </div>
</section>