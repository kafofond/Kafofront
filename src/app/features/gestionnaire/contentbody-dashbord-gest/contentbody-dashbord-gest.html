<main class="main-content">

  <!-- Indicateur de chargement -->
  <div *ngIf="isLoading" class="loading-indicator">
    <div class="spinner"></div>
    <p>Chargement des données...</p>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage" class="error-banner">
    {{ errorMessage }}
    <button class="retry-btn" (click)="loadDashboardData()">Réessayer</button>
  </div>

  <section id="stats" class="stats-cards" *ngIf="!isLoading && !errorMessage">
    <!-- Carte Lignes de Crédit -->
    <div class="stat-card-wrapper green">
      <div class="stat-card">
        <div class="card-header">
          <div class="card-icon-container green-bg">
            <img src="assets/41_5.svg" alt="Ligne de crédit Icon">
          </div>
          <span class="card-value">{{ formatNumber(stats.totalLignesCredit) }}</span>
        </div>
        <p class="card-title">Lignes de Crédit</p>
        <div class="progress-bar">
          <div class="progress-fill green" [style.width]="getLignesCreditWidth()"></div>
        </div>
        <div class="card-footer">
          <span>{{ stats.lignesCreditEnAttente }} en attente</span>
          <span>{{ stats.pourcentageLignesCreditTraitees }} %</span>
        </div>
      </div>
    </div>

    <!-- Carte Fiches de Besoin -->
    <div class="stat-card-wrapper orange">
      <div class="stat-card">
        <div class="card-header">
          <div class="card-icon-container orange-bg">
            <img src="assets/41_7.svg" alt="Fiche de besoin Icon">
          </div>
          <span class="card-value">{{ formatNumber(stats.totalFichesBesoin) }}</span>
        </div>
        <p class="card-title">Fiches de Besoin</p>
        <div class="progress-bar">
          <div class="progress-fill orange" [style.width]="getFichesBesoinWidth()"></div>
        </div>
        <div class="card-footer">
          <span>{{ stats.fichesBesoinEnAttente }} en attente</span>
          <span>{{ stats.pourcentageFichesBesoinTraitees }} %</span>
        </div>
      </div>
    </div>

    <!-- Carte Demandes d'Achat -->
    <div class="stat-card-wrapper red">
      <div class="stat-card">
        <div class="card-header">
          <div class="card-icon-container blue-bg">
            <img src="assets/41_9.svg" alt="Demande d'achat Icon">
          </div>
          <span class="card-value">{{ formatNumber(stats.totalDemandesAchat) }}</span>
        </div>
        <p class="card-title">Demandes d'Achat</p>
        <div class="progress-bar">
          <div class="progress-fill red" [style.width]="getDemandesAchatWidth()"></div>
        </div>
        <div class="card-footer">
          <span>{{ stats.demandesAchatEnAttente }} en attente</span>
          <span>{{ getDemandesAchatPercentage() }} %</span>
        </div>
      </div>
    </div>
  </section>

  <section id="activity" class="activity-section" *ngIf="!isLoading && !errorMessage">
    <div class="activity-header">
      <h3>Évolution des validations par mois</h3>
      <div class="activity-controls">
        <select id="periodSelect" [value]="currentPeriode" (change)="onPeriodeChange($event)">
          <option value="jour">Aujourd'hui</option>
          <option value="semaine">Cette semaine</option>
          <option value="mois">Ce mois</option>
        </select>

        <div class="activity-actions">
          <button class="btn btn-secondary" (click)="exportChart()">
            Exporter
          </button>
        </div>
      </div>
    </div>
    <div class="chart-container">
      <div *ngIf="chartLoading" class="chart-loading">
        <div class="spinner"></div>
        <p>Chargement du graphique...</p>
      </div>
      <canvas baseChart
        [data]="lineChartData"
        [options]="lineChartOptions"
        [type]="'line'">
      </canvas>
    </div>
  </section>

</main>